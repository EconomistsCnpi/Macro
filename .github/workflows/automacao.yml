name: Automação de relatório/dashbord
on:
    push:
        branches: ['main']
    schedule:
        - cron: '0 0 * * *'

jobs:
    Automacao:
        runs-on: ubuntu-24.04
        steps:
            - name: Clonar repositório
              uses: actions/checkout@v4
            
            - name: Instalar Python
              uses: actions/setup-python@v5
              with:
                python-version: 3.12.3

            - name: Instalar Poetry
              uses: snok/install-poetry@v1
              with:
                version: 1.8.5                     

            - name: Instalar Quarto
              uses: quarto-dev/quarto-actions/setup@v2
              with:
                version: 1.6.37
            
            - name: Verificar Quarto
              run: quarto --version   

            - name: Instalar Jupyter
              run: |
                poetry add jupyter      
            
            - name: Instalar Jupyter e PyYAML
              run: |
                poetry add jupyter pyyaml    

            - name: Atualização de relatório
              run: |
                poetry config virtualenvs.prefer-active-python true
                poetry run quarto render Programacao_Python_2/relatorio/relatorio.qmd

            - name: Install shiny
              run: |
                   pip install shiny rsconnect-python
                   
            - name: etl.py
              run: 
                poetry run python dashboard/etl.py

            - name: Adicionar conta rsconnect
              run:
                 poetry run rsconnect add --account ${{ secrets.ACCOUNT }} --name ${{ secrets.NAME }} --token ${{ secrets.TOKEN }} --secret ${{ secrets.SECRET }} 

            - name: Deploy da dashboard
              run:
                 poetry run rsconnect deploy shiny dashboard --name economistscnpi --title 'Macro Copa'     

            - name: Commit & Push
              uses: stefanzweifel/git-auto-commit-action@v5
              with:
                commit_message: Atualização de relatorio de dashboard






